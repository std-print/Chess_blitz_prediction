<h1 align='center'> Применение модели машинного обучения <br>в прогнозировании исхода <br>шахматного матча </h1>

<p align='right'> <strong>Над проектом трудились:</strong>
<br> Парамонов Всеволод
<br> Сидоров Иван
<br> Чубов Артем

---

<h3><strong>Раздел 0: Описание проекта</strong> </h3>
<br>
<p>
Целью нашего проекта является предсказание исхода предстоящего шахматного матча с помощью моделей машинного обучения на основании статистики по игрокам. Нами был выбран сайт lichess.org, поскольку это является самой крупной площадкой в мире онлайн шахмат и предоствляет огромное количество информации, которая может быть применима для наших целей.
<br>
</p>


<h3><strong>Раздел 1: Скачивание данных и их преобразование</strong> </h3>
<br>
На сайте lichess.org представлены базы данных по играм за определенный месяц. Нами было принято решение взять данные за март 2023. В ходе скачивания базы данных возникла проблема со скачиванием файла, а конкретно отсутствие памяти на компьютерах и довольно экзотический формат файла (PGN-файл), который смогут разахривировать лишь малое количество программ. После длительного промежутка времени удалось устранить эту проблему и избежать полнового скачивания файла. 
<br>
<br>
В итоговом полученном файле мы достали следующую информацию: никнеймы игроков, цвета, за которые играли игроки, режим игры, длительность игры, дата, когда была сыграна игра, и результат матча. В файле эти данные хранились в формате Json (рис. 1) и были преобразованы в Pandas таблицу с помощью собственно написанных функций, в частности: применили LabelEncoding для целевой переменной, преобразовали даты игр, а также временные форматы игр разделили на добавленное и основное время; для удобства работы над данными. В ходе исследования данных мы поняли, что нужно удалять дубликаты, чтобы разнообразить выборку, потому что, как оказалось, одни и те же игроки играют друг с другом в один и тот же временной формат. 
<br>
<br>
<img src='https://drive.google.com/uc?id=1pyanHNfq5t2W1xZ5CGCYULQkacowyVfr' width='400' style='display: block; margin: 0 auto;'>
<br>
<p align='center'> Рис.1 PGN-файл </p>
<br>

Также возникла проблема с репрезентативностью выборки, потому что в изначальном файле брались игры, которые были сыграны игры за один день. Чтобы избежать этого было принято решение брать игры с помощью цикла с шагом, но на данном этапе с этим возникают проблемы. Стоит упомянуть, что каждый из этих процессов занимает длительное время из-за большого размера файлов, поэтому было принято решение взять небольшое количество игр для демонстрации. 

<br>

<h3><strong>Раздел 2: Парсинг </strong> </h3>

<br>

После скачивания исходного файла и преобразования его в csv-файл был применен парсинг с помощью библиотеки BeautifulSoup. Для каждого матча мы хотели достать дополнительные признаки, такие как: рейтинги игроков в разных режимах, количество матчей, побед, ничьих, поражений, количество решенных пазлов и текущии серии побед и поражений. В ходе предварительного обучения модели было выяснено, что качество у признаков низкое (рис.2) и поэтому было принято решение добавить еще несколько признаков: отклонение рейтинга и результаты предыдущих партий, которые были сыграны игроками до матчей, которые мы рассматриваем (в процессе). Также мы планираем добавить звание игрока (GM, FM, IM, ...) в качестве признака.

<br>
<img src='https://drive.google.com/uc?id=1MOgiBHEHPqdwiBDC-H7tl4a813zAxHyb' width='200' style='display: block; margin: 0 auto;'>
<br>
<p align='center'> Рис.2 Признаки </p>
<br>

<p> На рис.2 видно, что текушая серия побед лучше всего влияет на результаты, которые выдает модель, поэтому мы выдвигаем гипотезу, чтобы парсинг последних трех игр как добавит новые признаки, так и улучшит качество будующей модели.
<br>

<h3><strong>Раздел 4: Гипотезы </strong> </h3>

<br>

<p> Для нашего мы выдвигаем следующие гипотезы, которые мы будем проверять в ходе выполнения нашего проекта:
<br>

1) Игроки, играющие за черные фигуры, проигрывают более чем в 50% случаев. Мы предполагаем, что белые должны выигрывать в половине случаев из-за преимущества первого хода у белых. Если множество значений {1,0}, то мы можем говорить, что при большом количестве наблюдений действует теорема Муавра-Лапласса, поэтому можно строить гипотезу о средних, иначе будем искать другие способы проверки гипотезы. 
<br>
<br>
<img src='https://drive.google.com/uc?export=view&id=1hFhqbZ3AkWG9SWixQGO81v5Ci1fxkohx' width='500' style='display: block; margin: 0 auto;'>
<br>
<p align='center'> Рис.3 Гистограмма результатов белых</p>
<br>
2) Влияет ли опыт игрока на результат матча. На данном этапе мы выбираем метрику опыта игрока: количество сыгранных игр, его рейтинг или же их комбинация. Наше предположение - более опытный игрок склонен выигрывать чаще, чем менее опытный игрок. Предположительно, мы будем не отвергать гипотезу, если более сильные игроки выигрывают более чем в 70% игр.
<br>

<br>
<img src='https://drive.google.com/uc?export=view&id=1VJ8C61Fvu32dyv7W5aU1rNTIfxbulKpA' width='500' style='display: block; margin: 0 auto;'>
<br>
<p align='center'> Рис.4 Зависимость количества побед игрока от рейтинга </p>
<br>

3) Мы хотим исследовать влияние временного формата шахматной партии в режиме Blitz на стандартное отклоение его рейтинга. Мы предполагаем, что чем более короткий режим игры, тем больше разброс рейтинга игрока, потому что более короткие игры содержат "элемент рандома".

<br>
<img src='https://drive.google.com/uc?export=view&id=1w2CR-nVX-5tmt_HrfQsq2jaKMT-hUwXG' width='500' style='display: block; margin: 0 auto;'>
<br>
<p align='center'> Рис.5 Совместное распределение основного времени и стандартного отклонения </p>
<br>
</p>

<br>

<h3><strong>Раздел 6: Обучение моделей </strong> </h3>
<br>
<p>
Наша модель должна решить задачу многоклассовой классификации (победа белых, победа черных, ничья), что оставляет нас с определенным пулом моделей, которые подходят нам, например: SVM, RandomForest, LogisticRegression и тд. Предварительно для этих моделей мы будем масштабировать данные с помощью StandartScaler либо MinMaxScaler, чтобы использовать регуляризацию для избежания переобучения и отбора признаков (в случае Lasso-регуляризации). Нами уже были опробованы методы ребалансировки классов (oversampling и undersampling), однако мы отказались от их использования, т.к. доля побед и поражений сопоставимы, а количество ничей слишком мало. 
<br>
<br>
В качестве метрик для задач классификации мы будем использовать классические показатели, такие как ROC-AUC, Accuracy, Precision, Recall, F-beta. Так как шахматы тоже являются разновидностью спорта, то мы не ставим 100% точности предсказаний нашей моделью и рассчитываем примерно на ROC-AUC = ~0.6-0.7. Нами была поставлена цель максимизировать точность наших предсказаний относительно их полноты, поэтому коэффициент β будет меньше 1.
</p>

